os: osx
osx_image: xcode11.3
language: generic
before_script:
 - brew update
 - brew install --HEAD usbmuxd
 - brew unlink usbmuxd
 - brew link usbmuxd
 - brew install --HEAD libimobiledevice
 - brew install ideviceinstaller
 - brew install ios-deploy
 - git clone https://github.com/flutter/flutter.git -b beta
script:
 - ./flutter/bin/flutter build ios --debug --no-codesign
cache:
  directories:
  - $HOME/.pub-cache
before_deploy:
  - pushd build/ios/iphoneos
  - mkdir Payload
  - cd Payload
  - ln -s ../Runner.app
  - cd ..
  - zip -r app.ipa Payload
  - popd
deploy:
  provider: releases
  api_key:
    secure: 29d2cc5777904261b75f32cdaa71e8c886f65463ad52433f88d039edde95e0b9
  file: build/ios/iphoneos/app.ipa
  skip_cleanup: true
  on:
    branch: master

